package cn.cenjp.platform.service;import cn.cenjp.platform.Prefix.CountPrefix;import cn.cenjp.platform.Prefix.KeyPrefix;import cn.cenjp.platform.redis.RedisService;import cn.cenjp.platform.utils.GetDate;import cn.cenjp.platform.vo.Info;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service;import org.springframework.ui.Model;import java.util.ArrayList;@Servicepublic class ManagerService {    @Autowired    RedisService redisService;    public void getInfo(Model model){        Integer year = GetDate.getYear();        Integer month = GetDate.getMonth();        Integer day = GetDate.getDay();        Integer week = GetDate.getWeek();        Info lastDay; //前天的数据        Info today;  //今天的数据        Info thisWeek; //本周的数据        Info thisMonth; //本月的数据        lastDay = getInfo(year,month,day-1);        today = getInfo(year,month,day);        thisWeek=getWeekInfo(year,month,day,week);        thisMonth=getMonthInfo(year,month,day);        model.addAttribute("lastDay",lastDay);        model.addAttribute("today",today);        model.addAttribute("thisWeek",thisWeek);        model.addAttribute("thisMonth",thisMonth);    }    public Info getInfo(Integer year,Integer month,Integer day){        Info info = new Info();        String key = ""+year+month+day;        Integer sendCount = redisService.get(CountPrefix.sendCountPrefix, key, Integer.class);        Integer addUser = redisService.get(CountPrefix.addUserCountPrefix, key, Integer.class);        Integer dayUser =redisService.getCount(CountPrefix.dayUserCountPrefix, key);        Double spikeFee = redisService.get(CountPrefix.spikeFeeCountPrefix, key, Double.class);        Integer spikeCount = redisService.get(CountPrefix.spikeCountPrefix, key, Integer.class);        if (sendCount==null) sendCount=0;        if (spikeCount==null) spikeCount=0;        if (spikeFee==null) spikeFee=0D;        if (addUser==null) addUser=0;        if (dayUser==null) dayUser=0;        info.setDayUser(dayUser);        info.setIncUser(addUser);        info.setSendGood(sendCount);        info.setSpikeCount(spikeCount);        info.setTurnOver(spikeFee);        return info;    }    public Info getWeekInfo(Integer year,Integer month,Integer day,Integer week){        Info info =new Info();        ArrayList<Integer> spikeCount = new ArrayList<>();        ArrayList<Integer> addUser = new ArrayList<>();        ArrayList<Integer> dayUser = new ArrayList<>();        ArrayList<Double> spikeFee = new ArrayList<>();        ArrayList<Integer> sendCount = new ArrayList<>();        String key = ""+year+month;        for (int i=0;i<week;i++){            day = day - i;            key =key +day;            spikeCount.add(redisService.get(CountPrefix.spikeCountPrefix, key, Integer.class));            addUser.add(redisService.get(CountPrefix.addUserCountPrefix, key, Integer.class));            sendCount.add(redisService.get(CountPrefix.sendCountPrefix, key, Integer.class));            dayUser.add(redisService.getCount(CountPrefix.dayUserCountPrefix, key));            spikeFee.add(redisService.get(CountPrefix.spikeFeeCountPrefix, key, Double.class));        }        info.setDayUser(dayUser.stream().filter(v->v!=null).reduce(0, (x, y) -> x + y));        info.setTurnOver(spikeFee.stream().filter(v->v!=null).reduce(0D, (x, y) -> x + y));        info.setIncUser(addUser.stream().filter(v->v!=null).reduce(0, (x, y) -> x + y));        info.setSendGood(sendCount.stream().filter(v->v!=null).reduce(0, (x, y) -> x + y));        info.setSpikeCount(spikeCount.stream().filter(v->v!=null).reduce(0, (x, y) -> x + y));        return info;    }    public Info getMonthInfo(Integer year,Integer month,Integer day){        Info info =new Info();        ArrayList<Integer> spikeCount = new ArrayList<>();        ArrayList<Integer> addUser = new ArrayList<>();        ArrayList<Integer> dayUser = new ArrayList<>();        ArrayList<Double> spikeFee = new ArrayList<>();        ArrayList<Integer> sendCount = new ArrayList<>();        String key ;        for (int i=0;i<day;i++){            day = day - i;            key =""+year+month+day;            spikeCount.add(redisService.get(CountPrefix.spikeCountPrefix, key, Integer.class));            addUser.add(redisService.get(CountPrefix.addUserCountPrefix, key, Integer.class));            sendCount.add(redisService.get(CountPrefix.sendCountPrefix, key, Integer.class));            dayUser.add(redisService.getCount(CountPrefix.dayUserCountPrefix, key));            spikeFee.add(redisService.get(CountPrefix.spikeFeeCountPrefix, key, Double.class));        }        info.setDayUser(dayUser.stream().filter(v->v!=null).reduce(0, (x, y) -> x + y));        info.setTurnOver(spikeFee.stream().filter(v->v!=null).reduce(0D, (x, y) -> x + y));        info.setIncUser(addUser.stream().filter(v->v!=null).reduce(0, (x, y) -> x + y));        info.setSendGood(sendCount.stream().filter(v->v!=null).reduce(0, (x, y) -> x + y));        info.setSpikeCount(spikeCount.stream().filter(v->v!=null).reduce(0, (x, y) -> x + y));        return info;    }}